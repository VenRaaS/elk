input {
        file {
                path => "/tmp/keywords.tsv"
                start_position => "beginning"
                type => "goods"
                tags => "keywords"
        }

        file {
                path => "/tmp/gid2ancestorCodes.tsv"
                start_position => "beginning"
                type => "goods"
                tags => "ancestors"
        }
}

filter {
        if [type] == "goods" and "keywords" in [tags] {
                csv {
                        columns => [ "code_name", "gid", "goods_keyword" ]
                        separator => "  "
                }
        }

        if [type] == "goods" and "ancestors" in [tags] {
                csv {
                        columns => [ "code_name", "gid", "a_category_code" ]
                        separator => "  "
                }

                mutate {
                        split => ["a_category_code", ","]
                }
        }

        mutate {
                remove_field => [ "message", "host", "path", "@version", "@timestamp", "file", "offset", "tags"]
        }
}

output {
        elasticsearch { 
                host => ["es-node-01:9300"]
                cluster => "westernwall"
                index => "%{code_name}_gocc"
                document_type => "%{type}"
                action => "update"
                document_id => "%{gid}"
        }

        stdout { 
                codec => rubydebug 
        }
}
