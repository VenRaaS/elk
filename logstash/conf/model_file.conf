input {
	file {
		path => "/home/elk/model/all_TP_dump.tsv"
		start_position => "beginning"
		type => "model_tp"
	}

#	file {
#		path => "/home/ua20101/goods_category_flatten.csv"
#		start_position => "beginning"
#		type => "model_goods_category_flatten"
#	}
}

filter {
	if [type] == "model_tp"  {
		csv {
			columns => [ "code_name", "id", "category_code", "le", "gids", "update_time" ]
			separator => "	"
		}

		mutate {
			split => ["gids",","]
			remove_field => [ "message", "host", "path", "@version", "@timestamp", "file", "offset" ]
		}
	}

	if [type] == "model_vig" {
		csv {
			columns => [ "code_name", "gid", "score", "update_time" ]
			separator => "	"
		}

		mutate {
			remove_field => [ "message", "host", "path", "@version", "@timestamp", "file", "offset" ]
		}
	}

	if [type] == "model_goods_category_flatten" {
		csv {
			columns => [ "code_name", "id", "category_code", "le", "gid", "update_time" ]
			separator => "	"
		}

		mutate {
			split => ["gids",","]
			remove_field => [ "message", "host", "path", "@version", "@timestamp", "file", "offset" ]
		}
	}

	if [type] == "model_breadcrumb" {
		csv {
			columns => [ "code_name", "gid", "breadcrumb", "update_time" ]
			separator => "	"
		}

		mutate {
			remove_field => [ "message", "host", "path", "@version", "@timestamp", "file", "offset" ]
		}
	}
}

output {
	if [type] == "model_tp" {
		elasticsearch { 
			host => ["es-node-01:9300"]
			cluster => "westernwall"
			index => "%{code_name}_mod"
			document_type => "tp"
		}
	}

	if [type] == "model_vig" {
		elasticsearch { 
			host => ["es-node-01:9300"]
			cluster => "westernwall"
			index => "%{code_name}_mod"
			document_type => "vig"
		}
	}

	if [type] == "model_goods_category_flatten" {
		elasticsearch { 
			host => ["es-node-01:9300"]
			cluster => "westernwall"
			index => "%{code_name}_mod"
			document_type => "goods_category_flatten"
		}
	}

	if [type] == "model_goods_category_flatten" {
		elasticsearch { 
			host => ["es-node-01:9300"]
			cluster => "westernwall"
			index => "%{code_name}_mod"
			document_type => "goods_category_flatten"
		}
	}

	if [type] == "model_breadcrumb" {
		elasticsearch { 
			host => ["es-node-01:9300"]
			cluster => "westernwall"
			index => "%{code_name}_mod"
			document_type => "breadcrumb"
		}
	}
	

#	stdout { 
#		codec => rubydebug 
#		codec => json 
#	}
	
}
