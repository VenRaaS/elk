input {
	file {
		path => "/home/ua20101/tmp_wlog.log"
		start_position => "beginning"
		codec => "json"
	}
}

filter {
	
	if "pageload" {
		#-- remove Backslash
		mutate {
			gsub => ["pageload", "[\\]", ""]
		}

		#-- extract action content from json array
		json {
			source => "[pageload][0]"
		}
	}

	if "cartadd" {
		mutate {
			gsub => ["cartadd", "[\\]", ""]
		}

		json {
			source => "[cartadd][0]"
		}
	}

	mutate {
		add_field => { "client" => "%{[client_ip][0]}" }
		add_field => { "logtime" => "%{[api_logtime][0]}" }
	}

	mutate {
		remove_field => [ "pageload", "cartadd" ]
		remove_field => [ "client_ip", "api_logtime" ]
		remove_field => [ "agent", "request_method", "api_loghost" ] 
		remove_field => [ "message", "host", "path", "@version", "@timestamp" ]
	}

}


output {

#	elasticsearch { 
#		host => ["140.96.83.31:9300"]
#		cluster => "westernwall"
#		index => "gohappy_mod"
#		document_type => "tp"
#	}

	stdout { 
		codec => rubydebug 
#		codec => json 
	}
}

